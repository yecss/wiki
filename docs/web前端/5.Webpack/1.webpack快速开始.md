# Webpack å¿«é€Ÿå¼€å§‹

å‚è€ƒæ–‡æ¡£ï¼š

å®˜æ–¹æ–‡æ¡£ï¼šhttps://webpack.docschina.org/concepts/

å°šç¡…è°·æ•™ç¨‹æ–‡æ¡£ï¼šhttps://yk2012.github.io/sgg_webpack5/

æ˜é‡‘ğŸ‘ï¼šhttps://juejin.cn/post/7014466035923288072#heading-16

å…¶ä»–ï¼šhttps://learn-docs.github.io/learn-webpack/

åšå®¢å›­ï¼šhttps://blog.csdn.net/celester_best/article/details/121875997

ç®€ä¹¦ï¼š[ç¬¬äº”èŠ‚:Webpackæ‰“åŒ…å›¾ç‰‡èµ„æº - ç®€ä¹¦ (jianshu.com)](https://www.jianshu.com/p/1c189a27ff0a?u_atoken=5782248a-24ab-4478-bf77-93eb627c3458&u_asession=01iScZuz7xtBMu_aGobiwrRBa5hY9l_vqekA2LvjWRwkIyJy-4xVmF3B4yvSRdqs0wX0KNBwm7Lovlpxjd_P_q4JsKWYrT3W_NKPr8w6oU7K_bBasbnTgZ2KsAiO-L4bprdSd2xtyR8tGtAryp6pbvRmBkFo3NEHBv0PZUm6pbxQU&u_asig=05H69Va14FVJPvFhEaQm8EDVS6wU4Fs4VkNbHKAmyNS2Com_kODnQboHgMR7fpR2upK-AHdo9JggrbRze3FhxOAzTslK7JdvdcGXWBVUeCCFXPYyRPRkv0cvTilgnBh18x4K3YXAN9pn4ZAQW7AmFBFBby_WxKiTWJh8Q26O0nZhX9JS7q8ZD7Xtz2Ly-b0kmuyAKRFSVJkkdwVUnyHAIJzRJZAr7ke6vuZ01XwAYLqKRMNIewgJE9JXo5ZIKWYyB0wt74LEzKVH73PIwzPMOHf-3h9VXwMyh6PgyDIVSG1W9ERyE3k3sbizeFgFyCJ7v732TG907D-0gWFGobKr9p4tNuuVwJr8e7p4DTEZh12UQMrzC0JZRYb8OShxDM9cnKmWspDxyAEEo4kbsryBKb9Q&u_aref=lG618gBU2SSv7Dl7CgrwBEQockg%3D)

## åˆå§‹åŒ–é¡¹ç›®

æ–°å»ºä¸€ä¸ªç©ºé¡¹ç›®ï¼Œæ‰§è¡Œå¦‚ä¸‹æ“ä½œ

```sh
yarn init -y
yarn add webpack webpack-cli --D
```

> å¼€å‘æ¨¡å¼ä¸‹èƒ½ç¼–è¯‘es6çš„è¯­æ³•ã€‚



webpack æœ¬èº«åŠŸèƒ½æ¯”è¾ƒå°‘ï¼Œåªèƒ½å¤„ç† jså’Œjson æ–‡ä»¶ï¼Œä¸€æ—¦é‡åˆ°äº†cssæ–‡ä»¶ç­‰å…¶ä»–æ–‡ä»¶å°±ä¼šæŠ¥é”™ã€‚

## äº”å¤§æ ¸å¿ƒæ¦‚å¿µ

é»˜è®¤çš„é…ç½®æ–‡ä»¶ï¼š `webpack.config.js`

```javascript
const path = require("path"); //nodejsæ ¸å¿ƒæ¨¡å—ï¼Œä¸“é—¨ç”¨æ¥å¤„ç†è·¯å¾„

module.exports = {
    // æ¨¡å¼
    // 1ã€developmentï¼šå¼€å‘ç¯å¢ƒï¼Œè¿›è¡Œæ‰“åŒ…æ—¶ï¼Œä¸ä¼šæ··æ·†ä»£ç ï¼Œæ‰“åŒ…é€Ÿåº¦æ›´å¿«ã€‚
    // 2ã€productionï¼šç”Ÿäº§ç¯å¢ƒï¼Œè¿›è¡Œæ‰“åŒ…æ—¶ï¼Œä¼šå‹ç¼©æ··æ·†ä»£ç ï¼Œæ‰“åŒ…é€Ÿåº¦è¾ƒæ…¢ã€‚
    // (æ··æ·†ï¼šå˜é‡åå‘ç”Ÿæ”¹å˜ï¼Œç©ºæ ¼ä¹Ÿå»é™¤äº†ï¼Œå¯ä»¥èŠ‚çº¦ä»£ç ä½“ç§¯ï¼Œåˆ é™¤æ‰€æœ‰æ³¨é‡Š)
    mode:"development"
    
    // å…¥å£
    entry:path.resolve(__dirname,"./src/main.js"), //è¦æ±‚ç»å¯¹è·¯å¾„
        
    // è¾“å‡º
    output:{
        // æ–‡ä»¶çš„è¾“å‡ºè·¯å¾„ (__dirnameä»£è¡¨å½“å‰æ–‡ä»¶çš„æ–‡ä»¶å¤¹ç›®å½•)
        path:path.resolve(__dirname,"dist"), //è¦æ±‚ç»å¯¹è·¯å¾„
        filename:"main.js"
    },
        
    // åŠ è½½å™¨
    module:{
        rules:{
            // loaderçš„é…ç½®
        }
    },
        
    // æ’ä»¶
    plugins:[],
        
    resolve: {
        extensions: [".js", ".jsx", ".json", ".vue"], //å‘Šè¯‰webpackå“ªäº›æ–‡ä»¶å¯ä»¥ä½œä¸ºæ¨¡å—å»ä½¿ç”¨
        alias: { //é…ç½®åˆ«å
          "@": path.resolve(__dirname, "../src"),
        },
    },
}
```



## åˆ›å»ºæ–‡ä»¶

åœ¨é¡¹ç›®ä¸­åˆ›å»º src æ–‡ä»¶å¤¹ï¼Œé‡Œé¢åˆ›å»ºä¸‹é¢è¿™äº›æ–‡ä»¶

**index.html**

```html
<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div class="box"></div>
    <div class="box2"></div>
  </body>
</html>
```

**main.js**

```javascript
import "./css/style.css"
function sayHi(){
  console.log(666)
}

sayHi()

let sayHello = ()=>{
  console.log(777)
}
sayHello()
```

**åœ¨cssæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºstyle.css**

```css
body{
  background-color: burlywood;
}
.box {
  width: 200px;
  height: 200px;
  background-color: coral;
}
.box2{
  height: 300px;
  width: 500px;
  background: url(../img/illustration_cover.png);
  background-size: contain;
}
```

## æ–‡ä»¶å¤„ç†

### CSS

åŠ è½½cssèµ„æºéœ€è¦å®‰è£…style-loaderï¼Œcss-loaderåº“

è¿™äº›åº“èƒ½å°†å¤šä¸ªCSSæ–‡ä»¶åˆå¹¶åˆ°ä¸€èµ·ï¼Œç„¶å’Œä½¿ç”¨JSå¯¼å…¥åˆ°HTMLå½“ä¸­

```javascript
rules:[
	{
        test:/\.css$/i,
        //æ‰§è¡Œé¡ºåºä»å³åˆ°å·¦
        use:[MiniCssExtractPlugin.loader,'css-loader']
    },
]
```

### å›¾ç‰‡

æ–¹æ³•ä¸€ã€ä½¿ç”¨webpack5å†…ç½®çš„å¤„ç†å™¨ä»£æ›¿ url-loader å’Œ file-loader

```javascript
// å¤„ç†å›¾ç‰‡èµ„æº
// é»˜è®¤åªèƒ½å¤„ç†CSSå¼•å…¥å’ŒJSå¼•å…¥çš„èµ„æº
{
    test: /\.(png|svg|jpg|jpeg|gif)$/i,
    type: "asset",
    generator: {
    filename: "static/img/[name].[hash:7][ext]",
    },
},
```

æ–¹æ³•äºŒ:ä½¿ç”¨loader

```javascript
module.exports = {
    // ...
    module:{
        rules:[
            {
                test: /\.(jpg|png|gif)$/,
                // ä½¿ç”¨ä¸€ä¸ªloaderå¤„ç†, ç”¨loaderé…ç½®
                loader: "url-loader",
                options:{
                    // é…ç½®å›¾ç‰‡æ‰“åŒ…loader 
                    // å›¾ç‰‡å¤§å°ä½äº8kbçš„ä¼šæ‰“åŒ…ä¸ºbase64æ ¼å¼,
                    // è¶…è¿‡çš„å¤„ç†ä¸ºæ–‡ä»¶æ ¼å¼
                    limit: 8 * 1024
                    // ç»™å›¾ç‰‡è¿›è¡Œé‡å‘½å
                    // [hash:8] æ˜¯å–å›¾ç‰‡æ‰“åŒ…çš„hashåçš„å‰8ä½
                    // [ext] å–å›¾ç‰‡åŸæ¥çš„æ–‡ä»¶æ‰©å±•å
                    name: '[hash:8].[ext]'
                }
            }
        ]
    },
    // ...
}
// ä¸Šé¢çš„é…ç½®åªèƒ½å¤„ç†CSSæˆ–è€…lessç­‰æ ·å¼æ–‡ä»¶ä¸­å¼•å…¥çš„å›¾ç‰‡
// é»˜è®¤ä¸èƒ½å¤„ç†htmlé€šè¿‡imgæ ‡ç­¾å¼•å…¥çš„å›¾ç‰‡, å¦‚æœéœ€è¦å¤„ç† imgæ ‡ç­¾å¼•å…¥çš„å›¾ç‰‡éœ€è¦ä½¿ç”¨å…¶ä»–çš„loader
```



## webpackå‡ å¤§æ³¨æ„äº‹é¡¹

### 1ã€CSS-loader

css-loaderåªèƒ½å¤„ç†é€šè¿‡JSå¼•å…¥çš„cssæ–‡ä»¶ã€‚

### 2ã€devserverçš„é…ç½®

outputç”Ÿæˆçš„htmlæ–‡ä»¶æœ€å¥½åˆ«æ”¹åï¼Œindexå³å¯ï¼Œä¸ç„¶å¼€å¯å¼€å‘æœåŠ¡å™¨åä¼šæ‰¾ä¸åˆ°æ–‡ä»¶ï¼Œæ˜¾ç¤º404ã€‚

### 3ã€loaderçš„ä½¿ç”¨é¡ºåº

loaderçš„ä½¿ç”¨é¡ºåºæ˜¯ä»å³åˆ°å·¦ï¼Œæ‰€ä»¥åœ¨é…ç½®çš„æ—¶å€™åº”è¯¥æ³¨æ„è¿™ä¸€ç‚¹ã€‚

### 4ã€loaderçš„æ­£åˆ™è¡¨è¾¾å¼çš„å«ä¹‰

iè¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™ï¼Œ$åŒ¹é…ä½ è¦ç”¨æ¥æŸ¥æ‰¾çš„å­—ç¬¦ä¸²ç»“å°¾

## webpacké…ç½®æ–‡ä»¶ç¤ºä¾‹

```JavaScript
// npx webpack --config ./config/webpack.prod.js
const path = require('path'); //nodejsæ ¸å¿ƒæ¨¡å—ï¼Œä¸“é—¨ç”¨æ¥å¤„ç†è·¯å¾„
const ESLintPlugin = require('eslint-webpack-plugin');
const HtmlWebpackPlugin = require('html-webpack-plugin');
const MiniCssExtractPlugin = require('mini-css-extract-plugin');
const CssMinimizerPlugin = require('css-minimizer-webpack-plugin');
const TerserPlugin = require('terser-webpack-plugin');
module.exports = {
    // å…¥å£
    entry: './src/main.js', //è¦æ±‚ç›¸å¯¹è·¯å¾„
    // è¾“å‡º
    output: {
        // æ–‡ä»¶çš„è¾“å‡ºè·¯å¾„ (__dirnameä»£è¡¨å½“å‰æ–‡ä»¶çš„æ–‡ä»¶å¤¹ç›®å½•)
        path: path.resolve(__dirname, '../dist'), //è¦æ±‚ç»å¯¹è·¯å¾„
        filename: 'static/js/main.js', //å…¥å£æ–‡ä»¶æ‰“åŒ…è¾“å‡ºæ–‡ä»¶å
        clean: true, // åœ¨æ‰“åŒ…å‰æ¸…ç©ºpathç›®å½•
    },
    // åŠ è½½å™¨
    module: {
        rules: [
            {
                // æ¯ä¸€ä¸ªæ–‡ä»¶åªè¢«ä¸€ä¸ªloaderé…ç½®å¤„ç†
                oneOf: [
                    // å¤„ç†CSS
                    {
                        test: /\.css$/i, //åªæ£€æµ‹cssæ–‡ä»¶
                        use: ['style-loader', 'css-loader'], //æ‰§è¡Œé¡ºåºä»å³åˆ°å·¦
                    },
                    // å¤„ç†Less
                    {
                        test: /\.less$/i,
                        // loaderåªèƒ½ä½¿ç”¨ä¸€ä¸ªloader,è€Œuseå¯ä»¥ä¸€æ¬¡ä½¿ç”¨å¤šä¸ªloader
                        use: [
                            // compiles Less to CSS
                            'style-loader',
                            'css-loader',
                            'less-loader',
                        ],
                    },
                    // å¤„ç†å›¾ç‰‡ç±»å‹
                    {
                        test: /\.(png|jpe?g|gif|webp|svg)$/,
                        type: 'asset', // å›¾ç‰‡è½¬base64è¿™é‡Œéœ€è¦é…ç½®asset
                        parser: {
                            dataUrlCondition: {
                                // å°äº20kbä¼šè½¬base64
                                // æœ‰ç‚¹å‡å°‘è¯·æ±‚æ•°é‡
                                maxSize: 20 * 1024,
                            },
                        },
                        generator: {
                            // è¾“å‡ºå›¾ç‰‡åç§°,hashç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„id,extæ–‡ä»¶æ‹“å±•å,queryé“¾æ¥æºå¸¦çš„å‚æ•°
                            filename: 'static/images/[hash:8][ext][query]',
                        },
                    },
                    // å¤„ç†å­—ä½“ç±»å‹
                    {
                        test: /\.ttf/,
                        type: 'asset/resource', // å›¾ç‰‡è½¬base64è¿™é‡Œéœ€è¦é…ç½®asset
                        generator: {
                            // è¾“å‡ºå›¾ç‰‡åç§°,hashç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„id,extæ–‡ä»¶æ‹“å±•å,queryé“¾æ¥æºå¸¦çš„å‚æ•°
                            filename: 'static/fonts/[hash:8][ext][query]',
                        },
                    },
                    {
                        test: /\.m?js$/,
                        exclude: /(node_modules|bower_components)/, //æ’é™¤node_modulesæ–‡ä»¶å¤¹
                        loader: 'babel-loader',
                        options: {
                            presets: ['@babel/preset-env'],
                            plugins: ['@babel/plugin-proposal-object-rest-spread'],
                        },
                    },
                ],
            },
        ],
    },
    optimization: {
        minimize: false,
        // å‹ç¼©ç›¸å…³
        minimizer: [new CssMinimizerPlugin(), new TerserPlugin()],
    },
    // æ’ä»¶
    plugins: [
        new ESLintPlugin({
            // æ£€æµ‹å“ªäº›æ–‡ä»¶
            context: path.resolve(__dirname, '../src'),
            exclude: 'node_modules',
            cache: true,
            cacheLocation: path.resolve(__dirname, '../node_modules/.cache/eslintCache'),
        }),
        new HtmlWebpackPlugin({
            // ä»¥publicä¸‹çš„index.htmlä¸ºæ¨¡æ¿ç”Ÿæˆæ–°çš„html
            template: path.resolve(__dirname, '../public/index.html'),
        }),
        new MiniCssExtractPlugin({
            filename: 'static/css/main.css',
        }),
    ],
    // æ¨¡å¼
    mode: 'production',
    devtool: 'source-map',
};
```



#webpack

